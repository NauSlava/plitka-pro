# cog.yaml
# Version: v4.4.36 - RUBBER TILE GENERATION MODEL (ИСПРАВЛЕНИЕ ПЕРЕПУТАННЫХ РАЗМЕРОВ TI)
# Description: Модель для генерации изображений резиновой плитки с использованием НАШЕЙ обученной модели
# Changes:
# - ДИАГНОСТИКА: Детальный анализ размеров text_encoder в SDXL pipeline
# - ДИАГНОСТИКА: Проверка совместимости размеров эмбеддингов (768 vs 1280)
# - ДИАГНОСТИКА: Анализ архитектуры SDXL для понимания реальных размеров
# - ИСПРАВЛЕНИЕ: Критическая ошибка атрибутов SDXL pipeline (tokenizer_one → tokenizer)
# - ИСПРАВЛЕНИЕ: Восстановлена корректная загрузка Textual Inversion
# - ИСПРАВЛЕНИЕ: Правильные атрибуты для SDXL: tokenizer, tokenizer_2, text_encoder, text_encoder_2
# - ИСПРАВЛЕНИЕ: Токены <s0><s1> теперь должны работать корректно
# - ИСПРАВЛЕНИЕ: Пропорции цветов должны соблюдаться после восстановления TI
# - ИСПРАВЛЕНИЕ: Детальное логирование для диагностики проблем
# - ИСПРАВЛЕНИЕ: Автозаполнение промптов в веб-интерфейсе
# - ИСПРАВЛЕНИЕ: Обновлен негативный промпт согласно требованиям
# - Модель теперь использует обученные веса (Textual Inversion + LoRA)
# - CUDA 12.1 (поддерживаемая версия cog)
# - torch>=2.1.0 (совместим с CUDA 12.1)
# - diffusers>=0.21.0 (совместим с PyTorch 2.1+)
# - transformers>=4.35.0 (совместим с PyTorch 2.1+)
# - accelerate>=0.24.0 (совместим с PyTorch 2.1+)
# - Использование НАШИХ LoRA адаптеров (rubber-tile-lora-v4_sdxl_lora.safetensors)
# - РУЧНАЯ ЗАГРУЗКА: Использование НАШИХ Textual Inversion с ДИАГНОСТИКОЙ РАЗМЕРОВ SDXL
# - Простой API интерфейс для WEB-приложений
# - Оптимизированные настройки для максимального качества

build:
  gpu: true
  cuda: "12.1"
  python_version: "3.11"
  python_requirements: "requirements.txt"
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
  cog_runtime: true

predict: "predict.py:Predictor"

image: "r8.im/nauslava/plitka-pro-project:v4.4.36"